<!--
  Copyright (C) 2022 The Infumap Authors
  This file is part of Infumap.

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/ico" href="/src/assets/favicon.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <link rel="apple-touch-icon" sizes="192x192" href="/src/assets/circle.png">
    <title>Infumap</title>
    <script type="text/javascript">
      const addPath = "/add";
      if (!location.href.endsWith(addPath)) {
        throw "Unexpected path";
      }
      fetch("/account/validate-session", { method: 'POST' })
        .then(async response => {
          try {
            if (response.status == 200) {
              const body = await response.json();
              if (body.success) {
                return;
              }
            }
          } catch {}
          location.href = location.href.substring(0, location.href.length - addPath.length) + "/login?redirect=add";
        });
    </script>
  </head>
  <body>
    <div>Add Note</div>
    <div style="padding: 10px;"><textarea id="note" rows="6" style="width: 100%;"></textarea></div>
    <div><button onclick="handleSubmit()">submit</button></div>
    <div id="status"></div>
  </body>
  <script>
    async function handleSubmit() {
      let jsonData = JSON.stringify({
        itemType: "note",
        title: document.getElementById("note").value,
        url: "",
        spatialWidthGr: 8 * 60,
      });
      document.getElementById("status").textContent = "adding";
      await fetch("/command", {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ command: "add-item", jsonData })
      });
      document.getElementById("status").textContent = "added";
      setTimeout(() => {
        document.getElementById("status").textContent = "";
      }, 2000);
    }
  </script>
</html>
